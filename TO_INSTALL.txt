ArduSub (SITL+GAZEBO)

      0)  Basic requirements:
ROS - noetic, Ubuntu 20.04, gazebo-11
sudo apt-get install ros-noetic-gazebo-ros-pkgs ros-noetic-gazebo-ros-control
sudo apt-get install git
sudo apt-get install -y libgazebo11-dev 

Create a directory (Let’s call in ~/ardusub) - Not a workspace

install freebuoyancy plugin (https://github.com/bluerobotics/freebuoyancy_gazebo)
cd ~/ardusub
git clone https://github.com/bluerobotics/freebuoyancy_gazebo.git
mkdir -p freebuoyancy_gazebo/build
cd freebuoyancy_gazebo/build/
cmake ..
make
export GAZEBO_PLUGIN_PATH=${GAZEBO_PLUGIN_PATH}:~/ardusub/freebuoyancy_gazebo/build

Install MAVROS
sudo apt-get install ros-noetic-mavros ros-noetic-mavros-extras
 wget https://raw.githubusercontent.com/mavlink/mavros/master/mavros/scripts/install_geographiclib_datasets.sh 
If the above step doesn’t work:
sudo gedit /etc/hosts
(Then at the end of this file, add the IP address.)
185.199.108.133 raw.githubusercontent.com
chmod +x ./install_geographiclib_datasets.sh
sudo ./install_geographiclib_datasets.sh

install the BlueROV2 simulations 
cd ~/ardusub
mkdir blue_ws
sudo apt install gazebo11 libgazebo11-dev
pip install setuptools==64.0.2
pip install testresources
sudo apt-get install ros-noetic-gazebo-ros-pkgs ros-noetic-gazebo-ros-control
cd blue_ws
mkdir src && cd src
git clone https://github.com/patrickelectric/bluerov_ros_playground 
git clone https://github.com/freefloating-gazebo/freefloating_gazebo.git
git clone https://github.com/freefloating-gazebo/freefloating_gazebo_demo.git
git clone https://github.com/kdkalvik/bluerov-ros-pkg.git
cd ../ && catkin_make
cd src
cd bluerov_ros_playground
source gazebo.sh
echo 'export GAZEBO_PLUGIN_PATH=${GAZEBO_PLUGIN_PATH}:~/ardusub/freebuoyancy_gazebo/build' >> gazebo.sh
echo "source ~/ardusub/catkin_ws_bluerov/src/bluerov_ros_playground/gazebo.sh" >> ~/ardusub/blue_ws_bluerov/devel/setup.bash
cd ~/ardusub/blue_ws
catkin_make

Install ardusub
cd ~/ardusub
git clone https://github.com/ArduPilot/ardupilot.git
cd ardupilot
git submodule init
git submodule update --recursive
Tools/environment_install/install-prereqs-ubuntu.sh -y
./Tools/gittools/submodule-sync.sh
. ~/.profile
sudo usermod -a -G dialout $USER
python3 waf configure
python3 waf clean
python3 waf sub
gedit ~/.bashrc
(in bashrc add the following lines) 
export PATH=~/ardusub/ardupilot/Tools/autotest:$PATH
export PATH=/ur/lib/ccache:$PATH

Install ardupilot plugin
 cd ~/ardusub
git clone https://github.com/Dreadnought-Robotics/ardupilot_gazebo.git
cd ardupilot_gazebo
mkdir build
cd build
cmake ../
make
sudo make install
echo 'source /usr/share/gazebo/setup.sh' >> ~/.bashrc
echo 'export GAZEBO_MODEL_PATH=~/ardusub/ardupilot_gazebo/models' >> ~/.bashrc
echo 'export GAZEBO_RESOURCE_PATH=~/ardusub/ardupilot_gazebo/worlds:${GAZEBO_RESOURCE_PATH}' >> ~/.bashrc
source ~/.bashrc
 
Finally install QGroundControl
sudo usermod -a -G dialout $USER
sudo apt-get remove modemmanager -y
sudo apt install gstreamer1.0-plugins-bad gstreamer1.0-libav gstreamer1.0-gl -y
sudo apt install libqt5gui5 -y
sudo apt install libfuse2 -y
Logout and login again to enable the change to user permissions.
Download QGroundControl.AppImage. (Open the hyperlink)
cd ~/Downloads
chmod +x ./QGroundControl.AppImage
./QGroundControl.AppImage
 
Select the Q icon on top left
Select Application settings
Select Comm Links
Select Add
Enter a name
Type -> UDP
Port -> 14552
Select ok
Close QGroundControl

ALL SET 
TO RUN:

Open a new terminal
cd ~/ardusub/ardupilot/ArduSub
source ~/.bashrc
sim_vehicle.py -f gazebo-bluerov2 -I 0 -j4 -D -L RATBeach --console
(SITL is now running)
view the world in Gazebo
cd ~/ardusub/blue_ws/src/bluerov_ros_playground
source gazebo.sh
gazebo --verbose worlds/underwater.world -u
CLICK ON PLAY at the bottom left of the Gazebo GUI
use the Mavros package 
roslaunch mavros apm.launch fcu_url:=udp://127.0.0.1:14550@
Launch QGroundControl
cd ~/Downloads
./QGroundControl.AppImage

Use QGroundControl or make you scripts of motion using MAVROS

